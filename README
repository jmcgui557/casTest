Clean and Simple Test
=====================

Author
------
Randall White (aka obibuffett)
obibuffett@cfl.rr.com
obibuffett@icloud.com

Introduction
------------
casTest is system of software tools (make files, scripts, library, and the
casTest executable) which is designed to make test driven development in C++
a bit easier.  Hopefully, quite a bit easier.  casTest is distributed with all
source code.  It is available in an easy to use self-extracting tarball from
one of my dropbox folders:

    https://www.dropbox.com/sh/2wtklxt4tyqoant/AAA54F3BVCyvVCvJiYVz6WNPa?dl=0

or can be cloned from GitHub:

    https://github.com/obibuffett/casTest.git

casTest started out as a personal project just to explore questions related
to testing frameworks.  As someone once said, to figure out how something
works, sometimes you have to implement it yourself.  (I seem to recall reading
this in one of Scott Meyers' books, but I can't seem to find the quote.  If
I have this wrong, my apologies to both Scott Meyers and the actual author.)
The casTest framework is the result of this exploration and was built using
Test Driven Development principles.  Although the tests found in 
<CAST_DIR>/src/test are now loaded as any other test created with casTest
make files, they started out as self-test routines within casTest.cpp and were
refactored after casTest had matured sufficiently.  I believe that the code
that is casTest provides a pretty wide range of interesting concepts for
new to mid-level C++ developers and I hope to produce a companion document of
some type in which to discuss these concepts.  To be sure they have been
covered by others much smarter than I am, but I feel the need to add my own
two cents worth to the discussion.  (I hope for better and not for worse.)

///////START HERE/////////
Installing casTest
------------------
- Self-extracting tarball

Installing casTest from the self-extracting tarball is probably the easiest
method of installation.  This is especially true for installing to a system
directory such as /usr/local or /opt as root.

To install casTest in this method, just copy installCast.bin to a directory
for which you have access and execute it.  If you'd like to install as root,
just use sudo (or su or login as root).

    > ./installCast.bin
or
    > sudo ./installCast.bin

Whether you install as a normal user or as root, you will be prompted for
a top-level installation location.  To accept the displayed default location,
just hit [enter].  The default installation location for normal users is
$HOME/cast.  For root it is /usr/local/cast.

After entering (or accepting) the installation location, installCast.bin will
do the following:

    - extract itself to the selected location
    - do a full build of all targets
    - create a resource script (castEnv.sourceMe.bash)
      in the installation directory

If you are installing as a normal user, installCast.bin will create a link
to castEnv.sourceMe.bash in the your home directory for convenience.  Before
using casTest for your testing needs, you must source this file.  If you are
installing as root, of course this link will not be created.  In this case,
users wishing to, may create the link themselves:

    #Creating a link to /usr/local/cast/castEnv.sourceMe.bash
    > cd $HOME
    > ln -s /usr/local/cast/castEnv.sourceMe.bash .

Whether installed as a normal user or root, castEnv.sourceMe.bash can be
sourced directly from the installation directory:

    > . <castParentDir>/cast/castEnv.sourceMe.bash

Quick Start (normal user installation)
--------------------------------------
After installing casTest, just source castEnv.sourceMe.bash and you'll be 
ready to create your first test.  
 
- Source castEnv.sourceMe.bash.
  > . ~/castEnv.sourceMe.bash

- Create a test dir and cd to it.
  > mkdir -p ~/myKata
  > cd ~/myKata

- Initialize a new test suite.
  > casTest -initTest myKata

  This step produces two files within the new directory:
    -- Makefile (makefile for myKata.test)
    -- myKata.tpp (source file for myKata.test)

  Despite the .tpp extension, myKata.tpp is a C++ source file.  It
  illustrates the use of the macros (defined in testCase.h) DEFINE_TEST
  and END_DEF.  These macros are provided to allow tests to be defined
  quickly and painlessly.  If you open myKata.tpp, you will see the
  test, SanityTest, defined as follows:

  DEFINE_TEST(SanityTest)
  void run()
  {
      bool val(false);

      Assert(val,
             "Please change val to true");
  }
  END_DEF

  As you can see, Assert() should fail when the line is executed as val is 
  initially defined as false.  You can build and run the test using make.

- Run make specifying 'test' as the target.
  > make test

  This step processes myKata.tpp, creates myKata.cpp, and builds then runs the
  test.  The output will be similar to the following:

  |  /<CAST_DIR>/tools/tpp2cpp.bash myKata.tpp
  |  tpp2cpp.bash: myKata.tpp -> myKata.cpp
  |  src: myKata.tpp dst: myKata.cpp
  |  /usr/bin/g++ -o myKata.o  -I/<CAST_DIR>/include  -fpic\
  |     -D_XOPEN_SOURCE=700 -g -fpic -DCAS_TEST -c myKata.cpp
  |  /usr/bin/g++ -o myKata.test  -I/<CAST_DIR>/include  \
  |     -shared  -L /<CAST_DIR>/lib myKata.o  -lcasTest
  |  /<CAST_DIR>/bin/casTest myKata.test
  |  
  |  casTest: Running tests from: myKata.test
  |  1..1
  |  not ok 1 - SanityTest
  |  	---
  |  	Caught cas::Test::Error: ERROR [testCase.cpp(58)]: Assertion FAILED: \
  |  Please change val to true,  and try again.
  |  	---
  |  casTest: 1 tests FAILED.
  |  
  |  make: *** [test] Error 1

  NOTE:  Of course if you prefer, instead of running "make test", you could 
         run make, then execute casTest passing in myKata.test in a second
         step.

         > make
         > casTest myKata.test

        You can also run multiple test suites from a single invocation.

        > casTest myKata.test myOtherKata.test ../anotherKata/anotherKata.test

- Next, edit myKata.tpp changing the line "bool val(false);" to read
  "bool val(true);"

- Rerun the test.
  > make test

  The output will now indicate success:

  |  /<CAST_DIR>/tools/tpp2cpp.bash myKata.tpp
  |  tpp2cpp.bash: myKata.tpp -> myKata.cpp
  |  src: myKata.tpp dst: myKata.cpp
  |  /usr/bin/g++ -o myKata.o  -I/<CAST_DIR>/include  -fpic\
  |  -D_XOPEN_SOURCE=700 -g -fpic -DCAS_TEST -c myKata.cpp
  |  /usr/bin/g++ -o myKata.test  -I/<CAST_DIR>/include  -shared\
  |   -L /<CAST_DIR>/lib myKata.o  -lcasTest
  |  /<CAST_DIR>/bin/casTest myKata.test
  |
  |  casTest: Running tests from: myKata.test
  |  1..1
  |  ok 1 - SanityTest
  |  casTest: All tests PASSED.

- Other tests can be added to myKata.tpp to create an entire suite of tests.
  Typically, several related tests will be added to the same .tpp file.
  Hopefully, this short intro will get you started.  For more detailed
  information about the working of casTest, see the manual (currently under
  construction).


Feedback is always welcome
--------------------------
Comments, question, and/or suggestions are most welcome.  Feel free to contact
me at GitHub (obibuffett), or send email to:

    obibuffett@cfl.rr.com

